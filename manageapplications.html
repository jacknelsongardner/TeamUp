<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


  <style>
    body {
        background-color: rgb(64, 133, 206);
    }

    .list-item {
      position: relative;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .list-item:hover {
      background-color: #f8f9fa; /* Add a subtle hover effect */
    }

    .list-item.selected {
      background-color: #cce5ff; /* Change the background color for selected items */
    }

    .edit-delete-buttons {
      display: none;
      position: absolute;
      top: 0;
      right: 0;
    }

    .logo {
  transform: translateY(-60%);
  left: 45%;
  position: absolute;
}
  </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container d-flex justify-content-between align-items-center" style="height: 50px">
            <a href="settings.html">
                <img src="user.webp" alt="" height="40px">
            </a>
    
            <div class="text-center flex-grow-1"> <!-- Updated class -->
                <a class="logo" href="#">
                    <img src="logo.png" alt="Logo" height="30">
                </a>
            </div>
    
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            </div>
            <div>
              <span id="coinCount" style="color: white; margin-right: 20px;">Coins: 0</span>
              <ul class="navbar-nav">
                  <li class="nav-item">
                      <a class="nav-link" href="login.html">Sign Out</a>
                  </li>
              </ul>
          </div>
        </div>
    </nav>


<div class="container mt-4" style="margin-left: 150px; margin-right: 150px;">
    <div class="row">

        <div class="col-md-4 text-center">
            <div>
                <h2 style="color: white;">Manage Applications</h2>

            </div>

            <div>
                <img src="applyicon.png" alt="" style="width: 230px; margin-top: 45px;">
            </div>

            <div>
                <p style="text-align: center; font-size: 15px; color: white; margin-top: 15px;">Welcome to the PowerUp Application Page! This tool lets you make custom applications for different roles you want to apply for.</p>
            </div>

            <div>
                <a href="swipeapplication.html">
                    <button type="button" class="btn btn-primary" style="margin-top: 10px">Recruit Roles</button>
                </a>
            </div>
        </div>


        <div class="col-md-8" style="justify-content: center ;">
            

            <div class="row">
                <div class="col-md-6" style="justify-content: left ;">
                    <a href="userdash.html">
                        <button  class="btn btn-light">Back</button>
                    </a>

                    <button class="createApplicationBtn btn btn-primary">Create Role</button>
                </div>
            </div>
            
            <div class="row">
                <div class="container mt-4">
                    <ul class="list-group">

                      <li class="list-group-item list-item">
                        Application 1
                        <div class="edit-delete-buttons">
                          <button class="editRoleModal btn btn-sm btn-secondary edit-btn" data-toggle="modal" data-target="#editModal">Edit</button>
                          <button class="btn btn-sm btn-danger delete-btn" >Delete</button>                        </div>
                      </li>

                      <li class="list-group-item list-item">
                        Application 2
                        <div class="edit-delete-buttons">
                          <button class="editRoleModal btn btn-sm btn-secondary edit-btn" data-toggle="modal" data-target="#editModal">Edit</button>
                          <button class="btn btn-sm btn-danger delete-btn" >Delete</button>
                        </div>
                      </li>

                    </ul>
                </div>
            </div>
            
        </div>

        

    </div>
    
</div>

<!-- Create Application Modal -->
<div class="modal fade" id="createApplicationModal" tabindex="-1" role="dialog" aria-labelledby="createApplicationModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createApplicationModalLabel">Create New Application</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="createApplicationForm">
          <div class="form-group">
            <label for="appName">Application Name:</label>
            <input type="text" class="form-control" id="appName" name="appName">
          </div>
          <div class="form-group">
            <label for="category">Category:</label>
            <select class="form-control" id="category" name="category">
              <option value="Employee">Employee</option>
              <option value="Admin">Admin</option>
              <!-- Add more options as needed -->
            </select>
          </div>
          <div class="form-group">
            <label for="description">Description:</label>
            <textarea class="form-control" id="description" name="description"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" form="createApplicationForm">Create Application</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Role Modal -->
<!-- Edit Role Modal -->
<div class="modal fade" id="editRoleModal" tabindex="-1" role="dialog" aria-labelledby="editRoleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editRoleModalLabel">Edit Role</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p><strong>Name:</strong> <span id="editRoleName"></span></p>
        <p><strong>Description:</strong> <span id="editRoleDescription"></span></p>
        <p><strong>Category:</strong> <span id="editRoleCategory"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <a href="swipeapplication.html">
          <button type="button" class="btn btn-success" id="recruitButton">Recruit</button>
        </a>
      </div>
    </div>
  </div>
</div>


<!-- JavaScript code enclosed within <script> tags -->
  
  
  <script>
    $(document).ready(function () {
      // Show create application modal when the "Create Application" button is clicked
      $('.createApplicationBtn').click(function() {
        $('#createApplicationModal').modal('show');
      });
  
      // Handle form submission
      $('#createApplicationForm').submit(function(event) {
        event.preventDefault(); // Prevent default form submission
  
        // Get form data
        var formData = {
           
          APPID: $('#appName').val(),
          category: $('#category').val(),
          description: $('#description').val()
        };
  
        // Send POST request to the server
        $.ajax({
          type: 'POST',
          url: '/createapplication',
          data: formData,
          success: function(response) {
            // Handle success response (if needed)
            console.log('Application created successfully');
            $('#createApplicationModal').modal('hide');

            window. alert("Success! Application created successfully")

            location.reload();
            // You might want to redirect the user to another page or show a success message
          },
          error: function(xhr, status, error) {
            // Handle error response (if needed)
            console.error('Error creating application:', error);
            // You might want to show an error message to the user
          }
        });
      });
    });
  </script>
  
  <script>
    $(document).ready(function () {
      // Function to fetch user applications
      function getUserApplications() {
        // Make AJAX request to the backend
        $.ajax({
          type: 'GET',
          url: '/getuserapplications',
          data: {}, // Replace 'your_user_id_here' with actual user ID
          success: function(response) {
            // Handle success response
            const applications = response.applications;
  
            // Clear existing applications
            $('.list-group').empty();
  
            // Populate applications dynamically
            applications.forEach(application => {
              const listItem = $('<li>').addClass('list-group-item list-item').text(application.APPID);
  
              // Adding click event listener to list item
              listItem.click(function() {
                  // Extract APPID from the text content of the clicked list item
                  const listItemText = $(this).text();
                  const APPID = listItemText.trim(); // Remove leading/trailing spaces if any
                  // Fetch data and update modal
                  fetchData(APPID);
                  // Show the modal
                  $('#editRoleModal').modal('show');
              });
  
              $('.list-group').append(listItem);
            });
          },
          error: function(xhr, status, error) {
            // Handle error response
            console.error('Error fetching user applications:', error);
            // You might want to show an error message to the user
          }
        });
      }
  
      // Call getUserApplications function when the page loads
      getUserApplications();
    });

    // Function to update values in the modal
  function updateModalValues(data) {
    const { roles } = data;
    if (roles.length > 0) {
      const app = applications[0]; // Assuming only one application is returned
      document.getElementById('editRoleName').innerText = app.APPID;
      document.getElementById('editRoleDescription').innerText = app.description;
      document.getElementById('editRoleCategory').innerText = app.category;
    }
  }

  // Function to make the GET request
  function fetchData(JOBID) {
    $.ajax({
        type: 'GET',
        url: `/application?JOBID=${JOBID}`,
        success: function(response) {
            // Handle success response
            updateModalValues(response);
        },
        error: function(xhr, status, error) {
            console.error('Error fetching data:', error);
            // Handle error if needed
        }
    });
}

  
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/getCoins')
        .then(response => response.json())
        .then(data => {
            document.getElementById('coinCount').textContent = `Coins: ${data.coins}`;
        })
        .catch(error => console.error('Error fetching coin data:', error));
    });
    </script>


</body>
</html>
