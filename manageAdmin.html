<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>User & Application List</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <style>
    body {
        background-color: rgb(64, 133, 206);
    }

    .list-item {
      position: relative;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .list-item:hover {
      background-color: #f8f9fa; /* Add a subtle hover effect */
    }

    .list-item.selected {
      background-color: #cce5ff; /* Change the background color for selected items */
    }

    .edit-delete-buttons {
      display: none;
      position: absolute;
      top: 0;
      right: 0;
    }

    .logo {
      transform: translateY(-60%);
      left: 45%;
      position: absolute;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container d-flex justify-content-between align-items-center" style="height: 50px">
        <a href="settings.html">
            <img src="user.webp" alt="" height="40px">
        </a>

        <div class="text-center flex-grow-1"> <!-- Updated class -->
            <a class="logo" href="#">
                <img src="logo.png" alt="Logo" height="30">
            </a>
        </div>

        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        </div>
        <div>
            <span id="coinCount" style="color: white; margin-right: 20px;">Coins: 0</span>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="login.html">Sign Out</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<div class="container mt-4">
    <div class="row">
      <div class="col-md-6">
        <div class="input-group mb-3">
          
          <div class="input-group-append">
            <form id="sqlForm">
                <div class="input-group mb-3">
                  <input type="text" class="form-control" id="sqlInput" name="sql" placeholder="Enter SQL command...">
                  <div class="input-group-append">
                    <button class="btn btn-primary" type="submit">Execute SQL</button>
                  </div>
                </div>
              </form>
              
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <h5>Applications List</h5>
        <ul id="applicationsList"></ul>
      </div>
      <div class="col-md-6">
        <h5>Users List</h5>
        <ul id="usersList"></ul>
      </div>

      <div class="col-md-6">
        <h5>JobPostings List</h5>
        <ul id="jobsList"></ul>
      </div>
    </div>
  </div>
  
  <script>
    // Function to fetch applications and users lists upon page load
    $(document).ready(function () {
      fetchLists(); // Fetch lists when the document is ready
    });
    function fetchLists() {
    // Fetch applications list
    fetch('/getAllApplications')
      .then(response => response.json())
      .then(applications => {

        console.log(applications);

        // Update applications list on the webpage
        const applicationsList = document.getElementById('applicationsList');
        applicationsList.innerHTML = ''; // Clear existing list
        for (let i = 0; i < applications.length; i++) {
          const listItem = document.createElement('li');
          listItem.textContent = applications[i];
          applicationsList.appendChild(listItem);
        }
      })
      .catch(error => console.error('Error fetching applications:', error));

    // Fetch users list
    fetch('/getAllUsers')
      .then(response => response.json())
      .then(users => {

        console.log(users);


        // Update users list on the webpage
        const usersList = document.getElementById('usersList');
        usersList.innerHTML = ''; // Clear existing list
        for (let i = 0; i < users.length; i++) {
          const listItem = document.createElement('li');
          listItem.textContent = users[i];
          usersList.appendChild(listItem);
        }
      })
      .catch(error => console.error('Error fetching users:', error));

      // Fetch users list
      fetch('/getAllJobs')
        .then(response => response.json())
        .then(jobPostings => {

            console.log(jobPostings);

            // Update job postings list on the webpage
            const jobsList = document.getElementById('jobsList');
            jobsList.innerHTML = ''; // Clear existing list
            for (let i = 0; i < jobPostings.length; i++) {
            const listItem = document.createElement('li');
            // Assuming each job posting has a property called 'title'
            listItem.textContent = jobPostings[i].title;
            jobsList.appendChild(listItem);
            }
        })
        .catch(error => console.error('Error fetching job postings:', error));
        }
  
    // Function to execute command and reload the page
    document.getElementById('sqlForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const sql = document.getElementById('sqlInput').value.trim();

        // Send the SQL command via a POST request
        fetch('/execute-sql', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({ sql })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            window.alert(data);
            // Reload the page to update the lists
            fetchLists();
        })
        .catch(error => console.error('Error executing SQL:', error), window.alert(error));
    });

  </script>
  
  </body>
  </html>